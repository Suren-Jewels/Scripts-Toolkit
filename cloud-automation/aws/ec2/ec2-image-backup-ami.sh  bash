#!/usr/bin/env bash
set -euo pipefail

# EC2 AMI backup automation:
# - Create AMI from instance
# - Optional name and description
# - Output AMI ID

usage() {
  echo "Usage: $0 <instance_id> <ami_name> [description]"
  echo "  instance_id : EC2 instance ID"
  echo "  ami_name    : Name for the AMI"
  echo "  description : Optional AMI description"
  exit 1
}

if [[ $# -lt 2 ]]; then
  usage
fi

INSTANCE_ID="$1"
AMI_NAME="$2"
DESCRIPTION="${3:-EC2 AMI backup}"

AMI_ID=$(aws ec2 create-image \
  --instance-id "${INSTANCE_ID}" \
  --name "${AMI_NAME}" \
  --description "${DESCRIPTION}" \
  --no-reboot \
  --query "ImageId" \
  --output text)

echo "AMI created: ${AMI_ID}"
